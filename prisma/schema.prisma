generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model employees {
    employee_id           Int                @id @default(autoincrement())
    branch_id             Int
    employee_code         String             @unique @db.VarChar(20)
    employee_title_th     String             @db.VarChar(20)
    employee_title_en     String             @db.VarChar(20)
    employee_firstname_th String             @db.VarChar(200)
    employee_lastname_th  String             @db.VarChar(200)
    employee_firstname_en String             @db.VarChar(200)
    employee_lastname_en  String             @db.VarChar(200)
    employee_fullname     String             @db.VarChar(400)
    employee_startdate    DateTime
    employee_resigndate   DateTime?
    employee_status       String             @db.VarChar(20)
    phone                 String             @db.VarChar(20)
    email                 String             @db.VarChar(255)
    remark                String?
    tax_id                String?            @db.VarChar(20)
    emp_type              Boolean            @default(false)
    position_id           Int
    department_id         Int
    is_active             Boolean            @default(true)
    manager_employee_id   Int?
    created_at            DateTime           @default(now())
    updated_at            DateTime           @default(now()) @updatedAt
    employeeAddresses     employee_address[]
    employeeAuths         employee_auth?
    branch                org_branch         @relation(fields: [branch_id], references: [branch_id])
    department            org_department     @relation(fields: [department_id], references: [department_id])
    manager_employee      employees?         @relation("EmployeeManager", fields: [manager_employee_id], references: [employee_id])
    employees             employees[]        @relation("EmployeeManager")
    position              org_position       @relation(fields: [position_id], references: [position_id])
    prHeaders             pr_header[]
}

/// ตารางเก็บข้อมูลการ login
model employee_auth {
    employee_id Int       @id
    username    String    @unique
    password    String
    is_active   Boolean   @default(true)
    created_at  DateTime  @default(now())
    updated_at  DateTime  @updatedAt
    employee    employees @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)
}

model employee_address {
    employee_address_id Int                 @id @default(autoincrement())
    employee_id         Int
    address_type        EmployeeAddressType
    address             String
    district            String?             @db.VarChar(100)
    province            String?             @db.VarChar(100)
    postal_code         String?             @db.VarChar(10)
    country             String              @db.VarChar(100)
    contact_person      String?             @db.VarChar(255)
    employee            employees           @relation(fields: [employee_id], references: [employee_id], onDelete: Cascade)
}

/// ตารางเก็บข้อมูลสาขา 
model org_branch {
    branch_code String       @unique @db.VarChar(20)
    branch_name String       @db.VarChar(200)
    is_active   Boolean      @default(true)
    branch_id   Int          @id @default(autoincrement())
    created_at  DateTime     @default(now())
    updated_at  DateTime     @updatedAt
    employees   employees[]
    prHeaders   pr_header[]
    rfqHeaders  rfq_header[]
    warehouses  warehouse[]

    @@map("org_branch")
}

/// ตารางเก็บข้อมูลตำแหน่ง 
model org_position {
    position_id      Int         @id @default(autoincrement())
    position_code    String      @unique @db.VarChar(20)
    position_name    String      @db.VarChar(200)
    position_name_en String      @db.VarChar(200)
    is_active        Boolean     @default(true)
    created_at       DateTime    @default(now())
    updated_at       DateTime    @updatedAt
    employees        employees[]
}

/// ตารางเก็บข้อมูลแผนก
model org_department {
    /// รหัสแผนก
    department_id      Int         @id @default(autoincrement())
    /// รหัสแผนก
    department_code    String      @unique @db.VarChar(20)
    /// ชื่อแผนก
    department_name    String      @db.VarChar(200)
    /// ชื่อแผนก (ภาษาอังกฤษ)
    department_name_en String      @db.VarChar(200)
    /// สถานะ
    is_active          Boolean     @default(true)
    /// วันที่สร้าง
    created_at         DateTime    @default(now())
    /// วันที่แก้ไข
    updated_at         DateTime    @updatedAt
    employees          employees[]
}

/// ตารางเก็บข้อมูลคลัง 
model warehouse {
    warehouse_code String     @unique @db.VarChar(20)
    warehouse_name String     @db.VarChar(200)
    warehouse_id   Int        @id @default(autoincrement())
    branch_id      Int
    address        String
    created_at     DateTime   @default(now())
    is_active      Boolean    @default(true)
    updated_at     DateTime   @updatedAt
    branch         org_branch @relation(fields: [branch_id], references: [branch_id])
    prLines        pr_line[]

    @@map("warehouse")
}

/// ไม่
/// ตารางเก็บข้อมูลสินค้า 
model item {
    item_code             String         @unique @db.VarChar(50)
    item_name             String         @db.VarChar(255)
    item_id               Int            @id @default(autoincrement())
    base_uom_id           Int
    created_at            DateTime       @default(now())
    default_tax_code      String?        @db.VarChar(20)
    item_brand_code       String?        @db.VarChar(20)
    item_brand_id         Int?
    item_category_code    String?        @db.VarChar(20)
    item_category_id      Int?
    item_class_code       String?        @db.VarChar(20)
    item_class_id         Int?
    item_design_code      String?        @db.VarChar(20)
    item_design_id        Int?
    item_group_code       String?        @db.VarChar(20)
    item_group_id         Int?
    item_pattern_code     String?        @db.VarChar(20)
    item_pattern_id       Int?
    item_size_code        String?        @db.VarChar(20)
    item_size_id          Int?
    item_type_code        String?        @db.VarChar(20)
    item_type_id          Int?
    purchase_uom_id       Int?
    sale_uom_id           Int?
    updated_at            DateTime       @updatedAt
    default_issue_policy  IssuePolicy    @default(FEFO)
    lot_tracking_level    TrackingLevel  @default(NONE)
    serial_tracking_level TrackingLevel  @default(NONE)
    shelf_life_days       Int?
    baseUom               uom            @relation("BaseUom", fields: [base_uom_id], references: [uom_id])
    itemBrand             item_brand?    @relation(fields: [item_brand_id], references: [item_brand_id])
    itemCategory          item_category? @relation(fields: [item_category_id], references: [item_category_id])
    itemClass             item_class?    @relation(fields: [item_class_id], references: [item_class_id])
    itemDesign            item_design?   @relation(fields: [item_design_id], references: [item_design_id])
    itemGroup             item_group?    @relation(fields: [item_group_id], references: [item_group_id])
    itemPattern           item_pattern?  @relation(fields: [item_pattern_id], references: [item_pattern_id])
    itemSize              item_size?     @relation(fields: [item_size_id], references: [item_size_id])
    itemType              item_type?     @relation(fields: [item_type_id], references: [item_type_id])
    purchaseUom           uom?           @relation("PurchaseUom", fields: [purchase_uom_id], references: [uom_id])
    saleUom               uom?           @relation("SaleUom", fields: [sale_uom_id], references: [uom_id])
    itemBarcodes          item_barcode[]
    itemUoms              item_uom[]
    prLines               pr_line[]

    @@index([lot_tracking_level])
    @@index([serial_tracking_level])
    @@index([default_issue_policy])
    @@map("item")
}

/// ตารางเก็บข้อมูลหน่วยนับ
model uom {
    uom_id        Int            @id @default(autoincrement())
    uom_code      String         @db.VarChar(20)
    uom_name      String         @db.VarChar(100)
    is_active     Boolean?       @default(true)
    created_at    DateTime       @default(now())
    uom_nameeng   String?        @db.VarChar(100)
    updated_at    DateTime       @updatedAt
    baseItems     item[]         @relation("BaseUom")
    purchaseItems item[]         @relation("PurchaseUom")
    saleItems     item[]         @relation("SaleUom")
    itemBarcodes  item_barcode[]
    fromItemUoms  item_uom[]     @relation("ItemUomFrom")
    toItemUoms    item_uom[]     @relation("ItemUomTo")
    prLines       pr_line[]
    rfqLines      rfq_line[]

    @@map("uom")
}

model item_uom {
    item_uom_id     String   @id @default(uuid())
    item_id         Int
    from_uom_id     Int
    to_uom_id       Int
    factor          Decimal  @db.Decimal(18, 6)
    is_purchase_uom Boolean  @default(false)
    created_at      DateTime @default(now())
    updated_at      DateTime @updatedAt
    fromUom         uom      @relation("ItemUomFrom", fields: [from_uom_id], references: [uom_id])
    item            item     @relation(fields: [item_id], references: [item_id])
    toUom           uom      @relation("ItemUomTo", fields: [to_uom_id], references: [uom_id])

    @@unique([item_id, from_uom_id, to_uom_id])
    @@map("item_uom")
}

/// ตารางเก็บข้อมูลประเภทสินค้า
model item_type {
    /// รหัสประเภทสินค้า
    item_type_id      Int        @id @default(autoincrement())
    /// รหัสประเภทสินค้า
    item_type_code    String     @unique @db.VarChar(30)
    /// ชื่อประเภทสินค้า
    item_type_name    String     @db.VarChar(200)
    /// ชื่อประเภทสินค้า (อังกฤษ)
    item_type_nameeng String     @db.VarChar(200)
    created_at        DateTime   @default(now())
    updated_at        DateTime   @updatedAt
    items             item[]
    rfqLines          rfq_line[]

    @@map("item_type")
}

/// ตารางเก็บข้อมูลบาร์โค้ดสินค้า
model item_barcode {
    /// รหัสบาร์โค้ด
    item_barcode_id   Int      @id @default(autoincrement())
    /// รหัสบาร์โค้ด
    item_barcode_code String   @db.VarChar(30)
    /// รหัสสินค้า
    item_id           Int
    /// รหัสหน่วยนับ
    uom_id            Int
    /// บาร์โค้ดหลักหรือไม่
    is_primary        Boolean
    /// วันที่สร้างบาร์โค้ด
    created_at        DateTime @default(now())
    /// วันที่แก้ไขบาร์โค้ด
    updated_at        DateTime @updatedAt
    item              item     @relation(fields: [item_id], references: [item_id])
    uom               uom      @relation(fields: [uom_id], references: [uom_id])

    @@map("item_barcode")
}

/// ตารางเก็บข้อมูลหมวดหมู่สินค้า
model item_category {
    /// รหัสหมวดหมู่สินค้า
    item_category_id      Int        @id @default(autoincrement())
    /// รหัสหมวดหมู่สินค้า
    item_category_code    String     @db.VarChar(30)
    /// ชื่อหมวดหมู่สินค้า
    item_category_name    String     @db.VarChar(200)
    /// ชื่อหมวดหมู่สินค้า (อังกฤษ)
    item_category_nameeng String?    @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active             Boolean
    /// วันที่สร้าง
    created_at            DateTime   @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at            DateTime   @updatedAt
    items                 item[]
    rfqLines              rfq_line[]

    @@map("item_category")
}

/// ตารางเก็บข้อมูลยี่ห้อสินค้า
model item_brand {
    /// รหัสยี่ห้อสินค้า
    item_brand_id      Int        @id @default(autoincrement())
    /// รหัสยี่ห้อสินค้า
    item_brand_code    String     @db.VarChar(30)
    /// ชื่อยี่ห้อสินค้า
    item_brand_name    String     @db.VarChar(200)
    /// ชื่อยี่ห้อสินค้า (อังกฤษ)
    item_brand_nameeng String     @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active          Boolean    @default(true)
    /// วันที่สร้าง
    created_at         DateTime   @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at         DateTime   @updatedAt
    items              item[]
    rfqLines           rfq_line[]

    @@map("item_brand")
}

/// ตารางเก็บข้อมูลลายสินค้า รูปแบบสินค้า
model item_pattern {
    /// รหัสลายสินค้า
    item_pattern_id      Int      @id @default(autoincrement())
    /// รหัสลายสินค้า
    item_pattern_code    String   @db.VarChar(30)
    /// ชื่อลายสินค้า
    item_pattern_name    String   @db.VarChar(200)
    /// ชื่อลายสินค้า (อังกฤษ)
    item_pattern_nameeng String?  @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active            Boolean? @default(true)
    /// วันที่สร้าง
    created_at           DateTime @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at           DateTime @updatedAt
    items                item[]

    @@map("item_pattern")
}

model item_design {
    /// รหัสลายสินค้า
    item_design_id      Int      @id @default(autoincrement())
    /// รหัสลายสินค้า
    item_design_code    String   @db.VarChar(30)
    /// ชื่อลายสินค้า
    item_design_name    String   @db.VarChar(200)
    /// ชื่อลายสินค้า (อังกฤษ)
    item_design_nameeng String?  @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active           Boolean? @default(true)
    /// วันที่สร้าง
    created_at          DateTime @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at          DateTime @updatedAt
    items               item[]

    @@map("item_design")
}

model item_class {
    /// รหัสคลาสสินค้า
    item_class_id      Int      @id @default(autoincrement())
    /// รหัสคลาสสินค้า
    item_class_code    String   @db.VarChar(30)
    /// ชื่อคลาสสินค้า
    item_class_name    String   @db.VarChar(200)
    /// ชื่อคลาสสินค้า (อังกฤษ)
    item_class_nameeng String?  @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active          Boolean? @default(true)
    /// วันที่สร้าง
    created_at         DateTime @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at         DateTime @updatedAt
    items              item[]

    @@map("item_class")
}

model item_size {
    /// รหัสขนาดสินค้า
    item_size_id      Int      @id @default(autoincrement())
    /// รหัสขนาดสินค้า
    item_size_code    String   @db.VarChar(30)
    /// ชื่อขนาดสินค้า
    item_size_name    String   @db.VarChar(200)
    /// ชื่อขนาดสินค้า (อังกฤษ)
    item_size_nameeng String?  @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active         Boolean? @default(true)
    /// วันที่สร้าง
    created_at        DateTime @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at        DateTime @updatedAt
    items             item[]

    @@map("item_size")
}

model item_group {
    /// รหัสกลุ่มสินค้า
    item_group_id      Int      @id @default(autoincrement())
    /// รหัสกลุ่มสินค้า
    item_group_code    String   @db.VarChar(30)
    /// ชื่อกลุ่มสินค้า
    item_group_name    String   @db.VarChar(200)
    /// ชื่อกลุ่มสินค้า (อังกฤษ)
    item_group_nameeng String?  @db.VarChar(200)
    /// สถานะการใช้งาน
    is_active          Boolean? @default(true)
    /// วันที่สร้าง
    created_at         DateTime @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at         DateTime @updatedAt
    items              item[]

    @@map("item_group")
}

/// ตารางเก็บข้อมูลเจ้าหนี้ M3
model vendor {
    /// รหัสเจ้าหนี้
    vendor_code        String                 @db.VarChar(30)
    /// ชื่อเจ้าหนี้
    vendor_name        String                 @db.VarChar(255)
    /// เลขที่ผู้เสียภาษี
    tax_id             String?                @db.VarChar(20)
    /// เครดิตเทอม (วัน)
    payment_term_days  Int
    /// รหัสเจ้าหนี้
    vendor_id          Int                    @id @default(autoincrement())
    created_at         DateTime               @default(now())
    /// อีเมล
    email              String?                @db.VarChar(255)
    /// สถานะ
    is_active          Boolean                @default(true)
    /// เบอร์โทรศัพท์
    phone              String?                @db.VarChar(20)
    updated_at         DateTime               @updatedAt
    /// รหัสกลุ่มเจ้าหนี้
    vendor_group_id    Int
    /// รหัสประเภทเจ้าหนี้
    vendor_type_id     Int
    /// สกุลเงิน
    currency_id        Int?
    /// จด VAT หรือไม่
    is_vat_registered  Boolean                @default(false)
    rfqLines           rfq_line[]
    currency           currency?              @relation(fields: [currency_id], references: [currency_id])
    vendor_group       vendor_group           @relation(fields: [vendor_group_id], references: [vendor_group_id])
    vendor_type        vendor_type            @relation(fields: [vendor_type_id], references: [vendor_type_id])
    vendorAddresses    vendor_address[]
    vendorBankAccounts vendor_bank_accounts[]
    vendorContacts     vendor_contacts[]
    vendorDocuments    vendor_documents[]
    vendorPerformances vendor_performance[]
    prHeaders          pr_header[]

    @@map("vendor")
}

model vendor_address {
    vendor_address_id Int               @id @default(autoincrement())
    vendor_id         Int
    /// REGISTERED / CONTACT / BILLING / SHIPPING
    address_type      VendorAddressType
    /// ที่อยู่
    address           String
    /// อำเภอ
    district          String?           @db.VarChar(100)
    /// จังหวัด
    province          String?           @db.VarChar(100)
    /// รหัสไปรษณีย์
    postal_code       String?           @db.VarChar(10)
    /// ประเทศ
    country           String            @db.VarChar(100)
    /// ผู้ติดต่อ
    contact_person    String?           @db.VarChar(255)
    /// เบอร์โทรศัพท์
    phone             String?           @db.VarChar(20)
    /// ต่อ
    phone_extension   String?           @db.VarChar(20)
    /// อีเมล
    email             String?           @db.VarChar(255)
    /// สถานะ
    is_default        Boolean           @default(false)
    /// สถานะ
    is_active         Boolean           @default(true)
    vendor            vendor            @relation(fields: [vendor_id], references: [vendor_id])

    @@index([vendor_id])
    @@map("vendor_address")
}

model vendor_type {
    /// รหัสประเภทเจ้าหนี้
    vendor_type_id      Int      @id @default(autoincrement())
    /// รหัสประเภทเจ้าหนี้
    vendor_type_code    String   @db.VarChar(30)
    /// ชื่อประเภทเจ้าหนี้
    vendor_type_name    String   @db.VarChar(200)
    /// ชื่อประเภทเจ้าหนี้ (อังกฤษ)
    vendor_type_nameeng String   @db.VarChar(200)
    /// รายละเอียดประเภทเจ้าหนี้
    description         String
    /// สถานะประเภทเจ้าหนี้
    status              String   @db.VarChar(20)
    created_at          DateTime @default(now())
    updated_at          DateTime @updatedAt
    vendors             vendor[]

    @@map("vendor_type")
}

/// ตารางกลุ่มเจ้าหนี้
model vendor_group {
    /// รหัสกลุ่มเจ้าหนี้
    vendor_group_id      Int      @id @default(autoincrement())
    /// รหัสกลุ่มเจ้าหนี้
    vendor_group_code    String   @db.VarChar(30)
    /// ชื่อกลุ่มเจ้าหนี้
    vendor_group_name    String   @db.VarChar(200)
    /// ชื่อกลุ่มเจ้าหนี้ (อังกฤษ)
    vendor_group_nameeng String   @db.VarChar(200)
    /// รายละเอียดกลุ่มเจ้าหนี้
    description          String
    /// สถานะกลุ่มเจ้าหนี้
    status               String   @db.VarChar(20)
    created_at           DateTime @default(now())
    updated_at           DateTime @updatedAt
    vendors              vendor[]

    @@map("vendor_group")
}

/// ตารางผู้ติดต่อ
model vendor_contacts {
    /// ชื่อผู้ติดต่อ
    contact_name String   @db.VarChar(100)
    /// ตำแหน่ง
    position     String?  @db.VarChar(100)
    /// แผนก
    department   String?  @db.VarChar(100)
    /// เบอร์โทรศัพท์
    phone        String?  @db.VarChar(20)
    /// เบอร์มือถือ
    mobile       String?  @db.VarChar(20)
    /// อีเมล
    email        String?  @db.VarChar(100)
    /// เป็นผู้ติดต่อหลักหรือไม่
    is_primary   Boolean  @default(false)
    /// วันที่สร้างข้อมูล
    created_at   DateTime @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at   DateTime @updatedAt
    /// รหัสผู้ติดต่อ (PK)
    contact_id   Int      @id @default(autoincrement())
    /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
    vendor_id    Int
    vendor       vendor   @relation(fields: [vendor_id], references: [vendor_id])

    @@index([vendor_id])
}

/// ตารางเก็บข้อมูลบัญชีธนาคารของเจ้าหนี้
model vendor_bank_accounts {
    /// ชื่อธนาคาร
    bank_name       String  @db.VarChar(100)
    /// สาขาธนาคาร
    bank_branch     String  @db.VarChar(100)
    /// เลขที่บัญชีธนาคาร
    account_no      String  @db.VarChar(30)
    /// ชื่อบัญชี
    account_name    String  @db.VarChar(200)
    /// ประเภทบัญชี SAVING / CURRENT
    account_type    String  @db.VarChar(20)
    /// รหัส SWIFT (ถ้ามี)
    swift_code      String? @db.VarChar(20)
    /// เป็นบัญชีหลักของเจ้าหนี้หรือไม่
    is_default      Boolean @default(false)
    /// PK รหัสบัญชีธนาคาร
    bank_account_id Int     @id @default(autoincrement())
    /// FK รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
    vendor_id       Int
    vendor          vendor  @relation(fields: [vendor_id], references: [vendor_id])

    @@index([vendor_id])
    @@map("vendor_bank_accounts")
}

/// ตารางเอกสารประกอบของเจ้าหนี้
model vendor_documents {
    /// ประเภทเอกสาร
    document_type String?   @db.VarChar(50)
    /// เลขที่เอกสาร
    document_no   String?   @db.VarChar(50)
    /// วันที่ออกเอกสาร
    issue_date    DateTime? @db.Date
    /// วันหมดอายุ
    expiry_date   DateTime? @db.Date
    /// ที่อยู่ไฟล์
    file_path     String?   @db.VarChar(500)
    /// ชื่อไฟล์
    file_name     String?   @db.VarChar(200)
    /// หมายเหตุ
    remark        String?
    /// วันที่สร้างข้อมูล
    created_at    DateTime  @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at    DateTime  @updatedAt
    /// รหัสเอกสาร (PK)
    document_id   Int       @id @default(autoincrement())
    /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
    vendor_id     Int
    vendor        vendor    @relation(fields: [vendor_id], references: [vendor_id])

    @@index([vendor_id])
    @@map("vendor_documents")
}

/// ตารางบันทึกผลการประเมินเจ้าหนี้
model vendor_performance {
    /// รหัสการประเมิน (PK)
    performance_id    Int       @id @default(autoincrement())
    /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
    vendor_id         Int
    /// วันที่ประเมิน
    evaluation_date   DateTime? @db.Date
    /// งวดการประเมิน
    evaluation_period String?   @db.VarChar(20)
    /// คะแนนคุณภาพ
    quality_score     Decimal?  @db.Decimal(5, 2)
    /// คะแนนการส่งมอบ
    delivery_score    Decimal?  @db.Decimal(5, 2)
    /// คะแนนราคา
    price_score       Decimal?  @db.Decimal(5, 2)
    /// คะแนนบริการ
    service_score     Decimal?  @db.Decimal(5, 2)
    /// คะแนนรวม
    total_score       Decimal?  @db.Decimal(5, 2)
    /// เกรดประเมิน
    rating            String?   @db.VarChar(1)
    /// หมายเหตุ
    remark            String?
    /// ผู้ประเมิน
    evaluated_by      String?   @db.VarChar(50)
    /// วันที่สร้างข้อมูล
    created_at        DateTime  @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at        DateTime  @updatedAt
    vendor            vendor    @relation(fields: [vendor_id], references: [vendor_id])

    @@map("vendor_performance")
}

/// ตารางหมวดหมู่เจ้าหนี้
model vendor_categories {
    /// รหัสหมวดหมู่ (PK)
    category_id        Int      @id @default(autoincrement())
    /// รหัสหมวดหมู่
    category_code      String?  @db.VarChar(20)
    /// ชื่อหมวดหมู่
    category_name      String?  @db.VarChar(100)
    /// รหัสหมวดหมู่แม่
    parent_category_id String?  @db.VarChar(20)
    /// สถานะการใช้งาน
    is_active          Boolean?

    @@map("vendor_categories")
}

/// ตารางเงื่อนไขการชำระ
model payment_terms {
    /// รหัสเงื่อนไขการชำระ (PK)
    payment_term_id Int      @id @default(autoincrement())
    /// รหัสเงื่อนไข
    term_code       String?  @db.VarChar(20)
    /// ชื่อเงื่อนไข
    term_name       String?  @db.VarChar(100)
    /// จำนวนวัน
    days            Int?
    /// สถานะการใช้งาน
    is_active       Boolean?

    @@map("payment_terms")
}

/// ตารางเก็บข้อมูลศูนย์ต้นทุน
model cost_center {
    /// รหัสศูนย์ต้นทุน
    cost_center_code String       @db.VarChar(30)
    /// ชื่อศูนย์ต้นทุน
    cost_center_name String       @db.VarChar(200)
    /// รหัสศูนย์ต้นทุน
    cost_center_id   Int          @id @default(autoincrement())
    projects         project[]
    rfqLines         rfq_line[]
    rfqHeaders       rfq_header[]

    @@map("cost_center")
}

/// ตารางเก็บข้อมูลโครงการ
model project {
    /// รหัสโครงการ
    project_code   String       @db.VarChar(30)
    /// ชื่อโครงการ
    project_name   String       @db.VarChar(200)
    /// รหัสโครงการ
    project_id     Int          @id @default(autoincrement())
    /// งบประมาณ
    budget_amount  Decimal      @db.Decimal(15, 2)
    /// รหัสศูนย์ต้นทุน
    cost_center_id Int
    /// รายละเอียดโครงการ
    description    String
    /// วันที่สิ้นสุดโครงการ
    end_date       DateTime
    /// วันที่เริ่มต้นโครงการ
    start_date     DateTime
    /// สถานะโครงการ
    status         String       @db.VarChar(20)
    cost_center    cost_center  @relation(fields: [cost_center_id], references: [cost_center_id])
    rfqLines       rfq_line[]
    rfqHeaders     rfq_header[]

    @@map("project")
}

model tax_code {
    /// รหัสกลุ่มภาษี
    tax_code_id  Int         @id @default(autoincrement())
    /// รหัสกลุ่มภาษี
    tax_code     String      @unique @db.VarChar(30)
    /// ชื่อกลุ่มภาษี
    tax_name     String
    /// รายละเอียดกลุ่มภาษี
    description  String?
    /// ประเภทภาษี
    tax_type     String      @db.VarChar(20)
    /// อัตราภาษี
    tax_rate     Decimal     @db.Decimal(15, 2)
    /// รหัสกลุ่มภาษี
    tax_group_id Int?
    tax_group    tax_group?  @relation(fields: [tax_group_id], references: [tax_group_id])
    /// สถานะกลุ่มภาษี (Y/N)
    is_active    Boolean     @default(true)
    created_at   DateTime    @default(now())
    updated_at   DateTime    @updatedAt
    prLines      pr_line[]
    rfqLines     rfq_line[]
    prHeaders    pr_header[]

    @@map("tax_code")
}

/// ตารางเก็บข้อมูลกลุ่มภาษี
model tax_group {
    /// รหัสกลุ่มภาษี
    tax_group_id   Int        @id @default(autoincrement())
    /// รหัสกลุ่มภาษี
    tax_group_code String     @unique @db.VarChar(30)
    /// รายละเอียดกลุ่มภาษี
    description    String?
    /// ประเภทภาษี
    tax_type       String     @db.VarChar(20)
    /// อัตราภาษี
    tax_rate       Decimal    @db.Decimal(15, 2)
    /// สถานะกลุ่มภาษี (Y/N)
    is_active      Boolean    @default(true)
    created_at     DateTime   @default(now())
    updated_at     DateTime   @updatedAt
    taxCodes       tax_code[]

    @@map("tax_group")
}

/// ตารางเก็บข้อมูลสกุลเงิน
model currency {
    /// รหัสสกุลเงิน
    currency_id      Int      @id @default(autoincrement())
    /// รหัสสกุลเงิน
    currency_code    String   @unique @db.VarChar(3)
    /// ชื่อสกุลเงิน
    currency_name    String   @db.VarChar(100)
    /// ชื่อสกุลเงิน (อังกฤษ)
    currency_nameeng String   @db.VarChar(100)
    /// อัตราแลกเปลี่ยน (THB)
    exchange_rate    Decimal  @db.Decimal(15, 2)
    /// สถานะสกุลเงิน
    status           String   @db.VarChar(20)
    created_at       DateTime @default(now())
    updated_at       DateTime @updatedAt
    vendors          vendor[]

    @@map("currency")
}

/// ตารางเก็บข้อมูลประเภทสกุลเงิน
model currency_type {
    /// รหัสประเภทสกุลเงิน
    currency_type_id      Int      @id @default(autoincrement())
    /// รหัสประเภทสกุลเงิน
    currency_type_code    String   @db.VarChar(30)
    /// ชื่อประเภทสกุลเงิน
    currency_type_name    String   @db.VarChar(200)
    /// ชื่อประเภทสกุลเงิน (อังกฤษ)
    currency_type_nameeng String   @db.VarChar(200)
    /// สถานะประเภทสกุลเงิน
    created_at            DateTime @default(now())
    updated_at            DateTime @updatedAt

    @@map("currency_type")
}

/// ตารางสถานที่รับ
model receive_place {
    /// รหัสสถานที่รับ
    receive_place_id      Int      @id @default(autoincrement())
    /// รหัสสถานที่รับ
    receive_place_code    String   @db.VarChar(30)
    /// ชื่อสถานที่รับ
    receive_place_name    String   @db.VarChar(200)
    /// ชื่อสถานที่รับ (อังกฤษ)
    receive_place_nameeng String   @db.VarChar(200)
    created_at            DateTime @default(now())
    updated_at            DateTime @updatedAt
    /// สถานะสถานที่รับ
    receive_contact       String   @db.VarChar(200)

    @@map("receive_place")
}

/// ตารางเก็บข้อมูลรูปแบบเอกสาร
model document_format {
    /// รหัสรูปแบบเอกสาร
    document_format_id Int                @id @default(autoincrement())
    /// รหัสโมดูล
    module_code        String
    /// รหัสประเภทเอกสาร
    document_type_code String
    /// ตัวอักษรนำหน้า
    prefix             String?
    /// จำนวนตัวเลข
    seq_length         Int
    /// รอบเลขที่เอกสาร
    running_cycle      String
    /// วันที่แก้ไขส
    updated_at         DateTime           @updatedAt
    /// วันที่สร้าง
    created_at         DateTime           @default(now())
    /// รูปแบบเลขที่เอกสาร
    pattern            String
    documentRunnings   document_running[]

    @@unique([module_code, document_type_code])
}

/// ตารางเก็บข้อมูลเลขที่เอกสาร
model document_running {
    /// รหัสเลขที่เอกสาร
    id                 Int             @id @default(autoincrement())
    /// รหัสรูปแบบเอกสาร
    document_format_id Int
    /// รหัสสาขา
    branch_id          Int?
    /// ตัวอักษรนำหน้า
    prefix             String?
    /// ปี
    year               Int?
    /// เดือน
    month              Int?
    /// วัน
    day                Int?
    /// เลขที่เอกสารสุดท้าย
    last_seq           Int
    /// วันที่แก้ไข
    updated_at         DateTime        @updatedAt
    document_format    document_format @relation(fields: [document_format_id], references: [document_format_id])

    @@unique([document_format_id, branch_id, prefix, year, month, day])
}

/// ตารางเก็บข้อมูลหลักของใบขอซื้อ (Purchase Requisition Header) (P1)
model pr_header {
    /// รหัสใบขอซื้อ (PK)
    pr_id      Int      @id @default(autoincrement())
    /// เลขที่ใบขอซื้อ
    pr_no      String   @db.VarChar(30)
    /// รหัสสาขา (FK)
    branch_id  Int
    /// สถานะ
    status     String   @db.VarChar(20)
    /// วันที่สร้าง
    created_at DateTime @default(now())

    /// สกุลเงินที่ใช้ทำรายการ (Base Currency)
    pr_base_amount         Decimal?  @db.Decimal(18, 6)
    pr_base_currency_code  String?   @db.VarChar(3)
    /// สกุลเงินที่ใช้ทำรายการ (Quote Currency)
    pr_quote_amount        Decimal?  @db.Decimal(18, 6)
    pr_quote_currency_code String?   @db.VarChar(3)
    /// อัตราแลกเปลี่ยน (1 quote → base) ui input
    pr_exchange_rate       Decimal?  @db.Decimal(18, 6)
    /// วันที่ของเรท ui input
    pr_exchange_rate_date  DateTime?
    /// จำนวนเงินรวม (Base Currency)
    pr_base_total_amount   Decimal   @db.Decimal(18, 2)
    /// จำนวนเงินรวม (Quote Currency)
    pr_quote_total_amount  Decimal   @db.Decimal(18, 2)
    /// ภาษี (Base Currency)
    pr_tax_amount          Decimal?  @db.Decimal(18, 2)
    /// อัตราภาษี
    pr_tax_rate            Decimal?  @db.Decimal(9, 4)
    /// รหัสกลุ่มภาษี (FK)
    pr_tax_code_id         Int?
    pr_tax_code            tax_code? @relation(fields: [pr_tax_code_id], references: [tax_code_id])
    /// ส่วนลดทั้งเอกสาร (string) จาก pr_line:line_amount
    pr_discount_raw        String?   @db.VarChar(10)
    /// % ส่วนลดทั้งเอกสาร (คำนวณจาก pr_discount_raw)
    pr_discount_rate       Decimal?  @db.Decimal(9, 4)
    /// จำนวนเงินส่วนลดทั้งเอกสาร (คำนวณจาก pr_discount_raw)
    pr_discount_amount     Decimal?  @db.Decimal(18, 2)

    /// วันที่ต้องการ
    need_by_date      DateTime?
    /// เครดิตเทอม (วัน)
    payment_term_days Int?
    /// วันที่สร้างใบขอซื้อ
    pr_date           DateTime
    /// หมายเหตุ
    remark            String?
    /// วันที่แก้ไขล่าสุด
    updated_at        DateTime  @updatedAt

    /// วันเครดิต
    credit_days   Int?
    /// วันที่ส่งมอบที่ต้องการ
    delivery_date DateTime?

    onhold              Boolean                @default(false)
    cancel_flag         Boolean                @default(false)
    /// ผู้ขายที่แนะนำ
    preferred_vendor    String?                @db.VarChar(100)
    /// ผู้ขอ
    requester_name      String?                @db.VarChar(100)
    /// รหัสผู้ขอ (FK)
    requester_user_id   Int
    /// วิธีการจัดส่ง
    shipping_method     String?                @db.VarChar(50)
    /// เลขที่ใบเสนอราคาจากผู้ขาย
    vendor_quote_no     String?                @db.VarChar(50)
    /// รหัสผู้ขายที่แนะนำ (FK)
    preferred_vendor_id Int?
    preferredVendor     vendor?                @relation(fields: [preferred_vendor_id], references: [vendor_id])
    branch              org_branch             @relation(fields: [branch_id], references: [branch_id])
    requester_user      employees              @relation(fields: [requester_user_id], references: [employee_id])
    prLines             pr_line[]
    quoteCompareHeaders quote_compare_header[]
    rfqHeaders          rfq_header[]

    @@map("pr_header")
}

/// ตารางเก็บข้อมูลรายละเอียดของใบขอซื้อ (Purchase Requisition Line) (P2)
model pr_line {
    /// รหัสใบขอซื้อ (PK)
    pr_line_id     Int     @id @default(autoincrement())
    /// ลำดับ
    line_no        Int
    /// รหัสสินค้า (FK)
    item_id        Int?
    /// รายละเอียด
    description    String?
    /// รหัสคลัง (FK)
    warehouse_id   Int?
    /// ตำแหน่งสินค้า
    location       String? @db.VarChar(50)
    /// รหัสใบขอซื้อ (FK)
    pr_id          Int
    /// จำนวน
    qty            Decimal @db.Decimal(18, 3)
    /// รหัสหน่วยนับ (FK)
    uom_id         Int
    /// ราคาต่อหน่วยโดยประมาณ
    est_unit_price Decimal @db.Decimal(18, 4)

    tax_code_id Int?
    // อัตราภาษี
    tax_rate    Decimal? @db.Decimal(9, 4)
    // ภาษี
    tax_amount  Decimal? @db.Decimal(18, 4)

    /// ส่วนลดต่อบรรทัด (string) จาก UI
    line_discount_raw    String?  @db.VarChar(10)
    /// % ส่วนลดต่อบรรทัด (คำนวณจาก line_discount_raw)
    line_discount_rate   Decimal? @db.Decimal(9, 4)
    /// จำนวนเงินส่วนลดต่อบรรทัด (คำนวณจาก line_discount_raw)
    line_discount_amount Decimal? @db.Decimal(18, 4)

    /// ยอดสุทธิต่อบรรทัด (หลังหักส่วนลด ยังไม่รวมภาษี)
    line_net_amount Decimal @db.Decimal(18, 4)

    /// จำนวนเงินต่อหน่วย (หลังหักส่วนลด รวมภาษี)
    line_amount Decimal @db.Decimal(18, 4)

    /// ประเภทการรับสินค้าที่ต้องการ GOODS/SERVICE
    required_receipt_type String?    @db.VarChar(20)
    item                  item?      @relation(fields: [item_id], references: [item_id])
    pr                    pr_header  @relation(fields: [pr_id], references: [pr_id])
    uom                   uom        @relation(fields: [uom_id], references: [uom_id])
    warehouse             warehouse? @relation(fields: [warehouse_id], references: [warehouse_id])
    tax_code              tax_code?  @relation(fields: [tax_code_id], references: [tax_code_id])

    @@unique([pr_id, line_no])
    @@index([pr_id])
}

/// ตารางเก็บข้อมูลหลักของใบขอซื้อ (Purchase for Quotation Header) (P3)
model rfq_header {
    /// รหัสใบขอซื้อ (PK)
    rfq_id             Int       @id @default(autoincrement())
    /// เลขที่ใบขอซื้อ
    rfq_no             String    @db.VarChar(30)
    /// วันที่สร้างใบขอซื้อ
    rfq_date           DateTime
    /// รหัสใบขอซื้อ (FK)
    qc_id              Int
    /// รหัสใบขอซื้อ (FK)
    pr_id              Int
    /// รหัสสาขา (FK)
    branch_id          Int
    /// ผู้ขอ
    requested_by       String    @db.VarChar(50)
    /// สถานะ
    status             String    @db.VarChar(20)
    /// วันที่ต้องการ
    quotation_due_date DateTime?
    /// รหัสสกุลเงิน
    currency_code      String    @db.VarChar(3)
    /// อัตราแลกเปลี่ยน
    exchange_rate      Decimal   @db.Decimal(18, 2)
    /// สถานที่รับสินค้า
    receive_location   String?
    /// เงื่อนไขการชำระเงิน
    payment_term_hint  String?   @db.VarChar(20)
    /// เงื่อนไขการส่งมอบ
    incoterm           String?   @db.VarChar(20)
    /// หมายเหตุ
    remarks            String?

    /// ศูนย์ต้นทุน (FK)
    cost_center_id Int?
    /// โครงการ (FK)
    project_id     Int?
    /// งบประมาณ (FK)
    budget_id      Int?
    /// บัญชี GL (FK)
    gl_account_id  Int?
    created_at     DateTime             @default(now())
    updated_at     DateTime             @updatedAt
    branch         org_branch           @relation(fields: [branch_id], references: [branch_id])
    pr             pr_header            @relation(fields: [pr_id], references: [pr_id])
    qc             quote_compare_header @relation(fields: [qc_id], references: [qc_id])
    cost_center    cost_center?         @relation(fields: [cost_center_id], references: [cost_center_id])
    project        project?             @relation(fields: [project_id], references: [project_id])
    rfqLines       rfq_line[]
}

/// ตารางเก็บข้อมูลหลักของใบขอซื้อ (Purchase for Quotation Line) (P4)
model rfq_line {
    /// รหัสใบขอซื้อ (PK)
    rfq_line_id Int     @id @default(autoincrement())
    /// ลำดับ
    line_no     Int
    /// รหัสสินค้า (FK)
    item_id     Int?
    /// รายละเอียด
    description String?
    /// รหัสใบขอซื้อ (FK)
    rfq_id      Int
    /// จำนวน
    qty         Decimal @db.Decimal(18, 3)
    /// รหัสหน่วยนับ (FK)
    uom_id      Int
    /// รหัสภาษี
    tax_code_id Int?

    /// รหัสศูนย์ต้นทุน (FK)
    cost_center_id                Int
    /// รหัสโครงการ (FK)
    project_id                    Int
    /// ประเภทการรับสินค้าที่ต้องการ
    required_receipt_type         String?        @db.VarChar(20)
    /// รหัสหมวดหมู่สินค้า
    item_categoryItem_category_id Int?
    /// รหัสยี่ห้อสินค้า
    item_brandItem_brand_id       Int?
    cost_center                   cost_center    @relation(fields: [cost_center_id], references: [cost_center_id])
    itemBrand                     item_brand?    @relation(fields: [item_brandItem_brand_id], references: [item_brand_id])
    itemCategory                  item_category? @relation(fields: [item_categoryItem_category_id], references: [item_category_id])
    item                          item_type?     @relation(fields: [item_id], references: [item_type_id])
    project                       project        @relation(fields: [project_id], references: [project_id])
    rfq                           rfq_header     @relation(fields: [rfq_id], references: [rfq_id])
    uom                           uom            @relation(fields: [uom_id], references: [uom_id])
    vendor                        vendor?        @relation(fields: [vendorVendor_id], references: [vendor_id])
    vendorVendor_id               Int?
    tax_code                      tax_code?      @relation(fields: [tax_code_id], references: [tax_code_id])

    @@unique([rfq_id, line_no])
    @@index([rfq_id])
}

/// ตารางเก็บข้อมูลหลักของใบเปรียบเทียบราคา (Purchase Requisition Header) (P5)
model quote_compare_header {
    /// รหัสใบเปรียบเทียบราคา (PK)
    qc_id      Int          @id @default(autoincrement())
    /// เลขที่ใบเปรียบเทียบราคา
    qc_no      String       @unique @db.VarChar(30)
    /// รหัสใบขอซื้อ (FK)
    pr_id      Int
    /// สถานะ
    status     String       @db.VarChar(20)
    /// วันที่สร้าง
    created_at DateTime     @default(now())
    /// วันที่แก้ไขล่าสุด
    updated_at DateTime     @updatedAt
    pr         pr_header    @relation(fields: [pr_id], references: [pr_id])
    rfqHeaders rfq_header[]
}

////////////
//// Audit Log
////////////

model audit_log {
    /// รหัส Audit Log (PK)
    audit_log_id  BigInt  @id @default(autoincrement())
    /// รหัสโมดูล
    module_code   String  @db.VarChar(20)
    /// ประเภทเอกสาร
    document_type String  @db.VarChar(30)
    /// รหัสเอกสาร
    document_id   BigInt
    /// เลขที่เอกสาร
    document_no   String? @db.VarChar(50)

    /// ชื่อตาราง
    table_name String  @db.VarChar(50)
    /// รหัสรายการ
    record_id  BigInt
    /// ชื่อฟิลด์
    field_name String? @db.VarChar(100)

    /// ค่าเดิม
    old_value   String?
    /// ค่าใหม่
    new_value   String?
    /// ประเภทการเปลี่ยนแปลง
    action_type String  @db.VarChar(20)
    /// สาเหตุ
    reason      String? @db.VarChar(255)

    /// รหัสผู้เปลี่ยนแปลง
    changed_by BigInt
    /// วันที่เปลี่ยนแปลง
    changed_at DateTime @default(now())

    /// รหัส Request
    request_id String  @db.Uuid
    /// รหัส Job
    job_id     String? @db.VarChar(100)

    /// IP Address ของผู้ใช้งาน
    client_ip  String? @db.VarChar(45)
    /// User Agent ของผู้ใช้งาน
    user_agent String? @db.VarChar(255)

    @@index([module_code, document_type, document_id])
    @@index([document_no])
    @@index([changed_at])
    @@index([changed_by])
    @@index([request_id])
    @@map("audit_log")
}

////////////
//// Enum
////////////

enum EmployeeAddressType {
    REGISTERED
    CONTACT
    BILLING
    SHIPPING
}

enum TrackingLevel {
    NONE
    OPTIONAL
    REQUIRED
}

enum IssuePolicy {
    FIFO
    FEFO
    MANUAL
}

enum VendorAddressType {
    REGISTERED
    CONTACT
    BILLING
    SHIPPING
}

enum RunningCycle {
    YEAR
    MONTH
    DAY
    NONE
}
