generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

//////////////
/// Master Data
/////////////

///ตารางเก็บข้อมูลสาขา M1
model org_branch {
  branch_id   Int          @id @default(autoincrement())
  branch_code String       @unique @db.VarChar(20)
  branch_name String       @db.VarChar(200)
  is_active   Boolean      @default(true)
  created_at  DateTime     @default(now())
  updated_at  DateTime     @updatedAt
  warehouses  warehouse[]
  prHeaders   pr_header[]
  rfqHeaders  rfq_header[]

  @@map("org_branch")
}

///ตารางเก็บข้อมูลตำแหน่ง 
model org_position {
  position_id      Int      @id @default(autoincrement())
  position_code    String   @unique @db.VarChar(20)
  position_name    String   @db.VarChar(200)
  position_name_en String   @db.VarChar(200)
  is_active        Boolean  @default(true)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
}

///ตารางเก็บข้อมูลแผนก
model org_department {
  ///รหัสแผนก
  department_id      Int      @id @default(autoincrement())
  ///รหัสแผนก
  department_code    String   @unique @db.VarChar(20)
  ///ชื่อแผนก
  department_name    String   @db.VarChar(200)
  ///ชื่อแผนก (ภาษาอังกฤษ)
  department_name_en String   @db.VarChar(200)
  ///สถานะ
  is_active          Boolean  @default(true)
  ///วันที่สร้าง
  created_at         DateTime @default(now())
  ///วันที่แก้ไข
  updated_at         DateTime @updatedAt
}

///ตารางเก็บข้อมูลคลัง M2
model warehouse {
  warehouse_id   Int         @id @default(autoincrement())
  branch_id      Int
  warehouse_code String      @unique @db.VarChar(20)
  warehouse_name String      @db.VarChar(200)
  address        String      @db.Text
  is_active      Boolean     @default(true)
  created_at     DateTime    @default(now())
  updated_at     DateTime    @updatedAt
  branch         org_branch  @relation(fields: [branch_id], references: [branch_id])
  prHeaders      pr_header[]

  @@map("warehouse")
}

///ตารางเก็บข้อมูลเจ้าหนี้ M3
model vendor {
  ///รหัสเจ้าหนี้
  vendor_id         Int      @id @default(autoincrement())
  ///รหัสเจ้าหนี้
  vendor_code       String   @db.VarChar(30)
  ///ชื่อเจ้าหนี้
  vendor_name       String   @db.VarChar(255)
  ///เลขที่ผู้เสียภาษี
  tax_id            String?  @db.VarChar(20)
  /// จด VAT หรือไม่
  is_vat_registered Boolean  @default(false)
  /// เครดิตเทอม (วัน)
  payment_term_days Int
  ///เบอร์โทรศัพท์
  phone             String?  @db.VarChar(20)
  ///อีเมล
  email             String?  @db.VarChar(255)
  ///สถานะ
  is_active         Boolean  @default(true)
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  ///รหัสประเภทเจ้าหนี้
  vendor_type_id    Int
  ///รหัสกลุ่มเจ้าหนี้
  vendor_group_id   Int
  ///สกุลเงิน
  currency_id       Int?

  vendor_type        vendor_type            @relation(fields: [vendor_type_id], references: [vendor_type_id])
  vendor_group       vendor_group           @relation(fields: [vendor_group_id], references: [vendor_group_id])
  currency           currency?              @relation(fields: [currency_id], references: [currency_id])
  prLines            pr_line[]
  rfqLines           rfq_line[]
  vendorAddresses    vendor_address[]
  vendorContacts     vendor_contacts[]
  vendorBankAccounts vendor_bank_accounts[]

  @@map("vendor")
}

model vendor_address {
  vendor_address_id Int @id @default(autoincrement())
  vendor_id         Int

  /// REGISTERED / CONTACT / BILLING / SHIPPING
  address_type    VendorAddressType
  /// ที่อยู่
  address         String            @db.Text
  /// อำเภอ
  district        String?           @db.VarChar(100)
  /// จังหวัด
  province        String?           @db.VarChar(100)
  /// รหัสไปรษณีย์
  postal_code     String?           @db.VarChar(10)
  /// ประเทศ
  country         String            @db.VarChar(100)
  /// ผู้ติดต่อ
  contact_person  String?           @db.VarChar(255)
  /// เบอร์โทรศัพท์
  phone           String?           @db.VarChar(20)
  /// ต่อ
  phone_extension String?           @db.VarChar(20)
  /// อีเมล
  email           String?           @db.VarChar(255)
  /// สถานะ
  is_default      Boolean           @default(false)
  /// สถานะ
  is_active       Boolean           @default(true)

  vendor vendor @relation(fields: [vendor_id], references: [vendor_id])

  @@index([vendor_id])
  @@map("vendor_address")
}

enum VendorAddressType {
  REGISTERED // ที่อยู่ตามเลขผู้เสียภาษี
  CONTACT // ที่อยู่ติดต่อ
  BILLING // วางบิล
  SHIPPING // ส่งของ
}

/// ไม่
///ตารางเก็บข้อมูลสินค้า 
model item {
  item_id               Int            @id @default(autoincrement())
  item_code             String         @db.VarChar(50)
  item_name             String         @db.VarChar(255)
  item_type             String         @db.VarChar(20)
  uom                   String         @db.VarChar(20)
  itemType              item_type?     @relation(fields: [item_typeItem_type_id], references: [item_type_id])
  item_typeItem_type_id Int?
  itemCategory          item_category? @relation(fields: [category_id], references: [item_category_id])
  category_id           Int?
  itemUoms              item_uom[]
  itemBarcodes          item_barcode[]

  @@map("item")
}

///ตารางเก็บข้อมูลหน่วยนับ
model uom {
  uom_id       Int            @id @default(autoincrement())
  uom_code     String         @db.VarChar(20)
  uom_name     String         @db.VarChar(100)
  is_active    Boolean?
  prLines      pr_line[]
  itemUoms1    item_uom[]     @relation("ItemUomFrom")
  itemUoms2    item_uom[]     @relation("ItemUomTo")
  itemUoms3    item_uom[]     @relation("ItemUom")
  itemBarcodes item_barcode[]
  rfqLines     rfq_line[]

  @@map("uom")
}

model item_uom {
  item_uom_id     String   @id @default(uuid())
  item_id         Int
  from_uom_id     Int
  to_uom_id       Int
  factor          Decimal  @db.Decimal(18, 6)
  is_purchase_uom Boolean  @default(false)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  item item @relation(fields: [item_id], references: [item_id])

  fromUom uom  @relation("ItemUomFrom", fields: [from_uom_id], references: [uom_id])
  toUom   uom  @relation("ItemUomTo", fields: [to_uom_id], references: [uom_id])
  uom     uom? @relation("ItemUom", fields: [uom_id], references: [uom_id])
  uom_id  Int?

  @@unique([item_id, from_uom_id, to_uom_id])
  @@map("item_uom")
}

///ตารางเก็บข้อมูลประเภทสินค้า
model item_type {
  ///รหัสประเภทสินค้า
  item_type_id      Int        @id @default(autoincrement())
  ///รหัสประเภทสินค้า
  item_type_code    String     @unique @db.VarChar(30)
  ///ชื่อประเภทสินค้า
  item_type_name    String     @db.VarChar(200)
  ///ชื่อประเภทสินค้า (อังกฤษ)
  item_type_nameeng String     @db.VarChar(200)
  created_at        DateTime   @default(now())
  updated_at        DateTime   @updatedAt
  items             item[]
  prLines           pr_line[]
  rfqLines          rfq_line[]

  @@map("item_type")
}

///ตารางเก็บข้อมูลบาร์โค้ดสินค้า
model item_barcode {
  ///รหัสบาร์โค้ด
  item_barcode_id   Int      @id @default(autoincrement())
  ///รหัสบาร์โค้ด
  item_barcode_code String   @db.VarChar(30)
  ///รหัสสินค้า
  item_id           Int
  ///รหัสหน่วยนับ
  uom_id            Int
  ///บาร์โค้ดหลักหรือไม่
  is_primary        Boolean
  ///รหัสสินค้า
  item              item     @relation(fields: [item_id], references: [item_id])
  ///รหัสหน่วยนับ
  uom               uom      @relation(fields: [uom_id], references: [uom_id])
  ///วันที่สร้างบาร์โค้ด
  created_at        DateTime @default(now())
  ///วันที่แก้ไขบาร์โค้ด
  updated_at        DateTime @updatedAt

  @@map("item_barcode")
}

///ตารางเก็บข้อมูลหมวดหมู่สินค้า
model item_category {
  ///รหัสหมวดหมู่สินค้า
  item_category_id      Int        @id @default(autoincrement())
  ///รหัสหมวดหมู่สินค้า
  item_category_code    String     @db.VarChar(30)
  ///ชื่อหมวดหมู่สินค้า
  item_category_name    String     @db.VarChar(200)
  ///ชื่อหมวดหมู่สินค้า (อังกฤษ)
  item_category_nameeng String     @db.VarChar(200)
  ///สถานะการใช้งาน
  is_active             Boolean
  ///วันที่สร้าง
  created_at            DateTime   @default(now())
  ///วันที่แก้ไขล่าสุด
  updated_at            DateTime   @updatedAt
  items                 item[]
  prLines               pr_line[]
  rfqLines              rfq_line[]

  @@map("item_category")
}

///ตารางเก็บข้อมูลศูนย์ต้นทุน
model cost_center {
  ///รหัสศูนย์ต้นทุน
  cost_center_id   Int        @id @default(autoincrement())
  ///รหัสศูนย์ต้นทุน
  cost_center_code String     @db.VarChar(30)
  ///ชื่อศูนย์ต้นทุน
  cost_center_name String     @db.VarChar(200)
  ///โครงการ
  projects         project[]
  prLines          pr_line[]
  rfqLines         rfq_line[]

  @@map("cost_center")
}

///ตารางเก็บข้อมูลโครงการ
model project {
  ///รหัสโครงการ
  project_id     Int         @id @default(autoincrement())
  ///รหัสโครงการ
  project_code   String      @db.VarChar(30)
  ///ชื่อโครงการ
  project_name   String      @db.VarChar(200)
  ///รายละเอียดโครงการ
  description    String
  ///รหัสศูนย์ต้นทุน
  cost_center_id Int
  cost_center    cost_center @relation(fields: [cost_center_id], references: [cost_center_id])
  ///งบประมาณ
  budget_amount  Decimal     @db.Decimal(15, 2)
  ///วันที่เริ่มต้นโครงการ
  start_date     DateTime
  ///วันที่สิ้นสุดโครงการ
  end_date       DateTime
  ///สถานะโครงการ
  status         String      @db.VarChar(20)
  prLines        pr_line[]
  rfqLines       rfq_line[]

  @@map("project")
}

///ตารางเก็บข้อมูลประเภทเจ้าหนี้
model vendor_type {
  ///รหัสประเภทเจ้าหนี้
  vendor_type_id      Int      @id @default(autoincrement())
  ///รหัสประเภทเจ้าหนี้
  vendor_type_code    String   @db.VarChar(30)
  ///ชื่อประเภทเจ้าหนี้
  vendor_type_name    String   @db.VarChar(200)
  ///ชื่อประเภทเจ้าหนี้ (อังกฤษ)
  vendor_type_nameeng String   @db.VarChar(200)
  ///รายละเอียดประเภทเจ้าหนี้
  description         String
  ///สถานะประเภทเจ้าหนี้
  status              String   @db.VarChar(20)
  created_at          DateTime @default(now())
  updated_at          DateTime @updatedAt
  vendors             vendor[]

  @@map("vendor_type")
}

/// ตารางกลุ่มเจ้าหนี้
model vendor_group {
  ///รหัสกลุ่มเจ้าหนี้
  vendor_group_id      Int      @id @default(autoincrement())
  ///รหัสกลุ่มเจ้าหนี้
  vendor_group_code    String   @db.VarChar(30)
  ///ชื่อกลุ่มเจ้าหนี้
  vendor_group_name    String   @db.VarChar(200)
  ///ชื่อกลุ่มเจ้าหนี้ (อังกฤษ)
  vendor_group_nameeng String   @db.VarChar(200)
  ///รายละเอียดกลุ่มเจ้าหนี้
  description          String
  ///สถานะกลุ่มเจ้าหนี้
  status               String   @db.VarChar(20)
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
  vendors              vendor[]

  @@map("vendor_group")
}

///ตารางเก็บข้อมูลกลุ่มภาษี
model tax_group {
  ///รหัสกลุ่มภาษี
  tax_group_id   Int      @id @default(autoincrement())
  ///รหัสกลุ่มภาษี
  tax_group_code String   @db.VarChar(30)
  ///รายละเอียดกลุ่มภาษี
  description    String
  ///ประเภทภาษี
  tax_type       String   @db.VarChar(20)
  ///อัตราภาษี
  tax_rate       Decimal  @db.Decimal(15, 2)
  ///สถานะกลุ่มภาษี
  status         String   @db.VarChar(20)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt

  @@map("tax_group")
}

///ตารางเก็บข้อมูลสกุลเงิน
model currency {
  ///รหัสสกุลเงิน
  currency_id      Int      @id @default(autoincrement())
  ///รหัสสกุลเงิน
  currency_code    String   @db.VarChar(30)
  ///ชื่อสกุลเงิน
  currency_name    String   @db.VarChar(200)
  ///ชื่อสกุลเงิน (อังกฤษ)
  currency_nameeng String   @db.VarChar(200)
  ///อัตราแลกเปลี่ยน (THB)
  exchange_rate    Decimal  @db.Decimal(15, 2)
  ///สถานะสกุลเงิน
  status           String   @db.VarChar(20)
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt
  vendors          vendor[]

  @@map("currency")
}

///ตารางเก็บข้อมูลประเภทสกุลเงิน
model currency_type {
  ///รหัสประเภทสกุลเงิน
  currency_type_id      Int      @id @default(autoincrement())
  ///รหัสประเภทสกุลเงิน
  currency_type_code    String   @db.VarChar(30)
  ///ชื่อประเภทสกุลเงิน
  currency_type_name    String   @db.VarChar(200)
  ///ชื่อประเภทสกุลเงิน (อังกฤษ)
  currency_type_nameeng String   @db.VarChar(200)
  ///สถานะประเภทสกุลเงิน
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt

  @@map("currency_type")
}

/// ตารางสถานที่รับ
model receive_place {
  ///รหัสสถานที่รับ
  receive_place_id      Int    @id @default(autoincrement())
  ///รหัสสถานที่รับ
  receive_place_code    String @db.VarChar(30)
  ///ชื่อสถานที่รับ
  receive_place_name    String @db.VarChar(200)
  ///ชื่อสถานที่รับ (อังกฤษ)
  receive_place_nameeng String @db.VarChar(200)

  ///สถานะสถานที่รับ
  receive_contact String   @db.VarChar(200)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  @@map("receive_place")
}

/// ตารางเจ้าหนี้
model vendor_master {
  /// รหัสเจ้าหนี้
  vendor_code           String?   @db.VarChar(20)
  /// ชื่อเจ้าหนี้ (ไทย)
  vendor_name           String?   @db.VarChar(200)
  /// ชื่อเจ้าหนี้ (อังกฤษ)
  vendor_name_en        String?   @db.VarChar(200)
  /// ประเภทเจ้าหนี้ (MANUFACTURER, DISTRIBUTOR, etc.)
  vendor_type           String?   @db.VarChar(30)
  /// หมวดหมู่ธุรกิจ
  category              String?   @db.VarChar(100)
  /// เลขประจำตัวผู้เสียภาษี
  tax_id                String?   @db.VarChar(13)
  /// ชื่อสาขา
  branch_name           String?   @db.VarChar(100)
  /// จดทะเบียน VAT หรือไม่
  is_vat_registered     Boolean?
  /// มีการหัก ณ ที่จ่ายหรือไม่
  wht_applicable        Boolean?
  /// เงื่อนไขการชำระเงิน (วัน)
  payment_term_days     Int?
  /// วงเงินเครดิต
  credit_limit          Decimal?  @db.Decimal(15, 2)
  /// รหัสสกุลเงิน
  currency_code         String?   @db.VarChar(3)
  /// สถานะ (ACTIVE, INACTIVE)
  status                String?   @db.VarChar(20)
  /// เกรดประเมิน (A–E)
  rating                String?   @db.VarChar(1)
  /// คะแนนประเมินผล (0–100)
  performance_score     Decimal?  @db.Decimal(5, 2)
  /// ผู้ติดต่อหลัก
  contact_person        String?   @db.VarChar(100)
  /// เบอร์โทรศัพท์
  phone                 String?   @db.VarChar(20)
  /// เบอร์มือถือ
  mobile                String?   @db.VarChar(20)
  /// อีเมล
  email                 String?   @db.VarChar(100)
  /// เว็บไซต์
  website               String?   @db.VarChar(200)
  /// ที่อยู่
  address               String?
  /// เขต/อำเภอ
  district              String?   @db.VarChar(100)
  /// จังหวัด
  province              String?   @db.VarChar(100)
  /// รหัสไปรษณีย์
  postal_code           String?   @db.VarChar(10)
  /// ประเทศ
  country               String?   @db.VarChar(100)
  /// วันที่ลงทะเบียน
  registration_date     DateTime? @db.Date
  /// วันที่อนุมัติ
  approved_date         DateTime? @db.Date
  /// วันที่ทำธุรกรรมล่าสุด
  last_transaction_date DateTime? @db.Date
  /// มูลค่าการซื้อทั้งหมด
  total_purchase_amount Decimal?  @db.Decimal(15, 2)
  /// หมายเหตุ
  remark                String?
  /// ผู้สร้าง
  created_by            String?   @db.VarChar(50)
  /// วันที่สร้าง
  created_date          DateTime  @default(now())
  /// ผู้แก้ไข
  updated_by            String?   @db.VarChar(50)
  /// วันที่แก้ไข
  updated_date          DateTime  @updatedAt
  /// PK รหัสอ้างอิงเจ้าหนี้
  vendor_id             Int       @id @default(autoincrement())

  /// API layer (พอแล้ว ไม่ต้องมีมากกว่านี้)

  contacts           vendor_contacts[]
  bank_accounts      vendor_bank_accounts[]
  vendorDocuments    vendor_documents[]
  vendorPerformances vendor_performance[]

  @@map("vendor_master")
}

/// ตารางผู้ติดต่อ
model vendor_contacts {
  /// ชื่อผู้ติดต่อ
  contact_name           String         @db.VarChar(100)
  /// ตำแหน่ง
  position               String?        @db.VarChar(100)
  /// แผนก
  department             String?        @db.VarChar(100)
  /// เบอร์โทรศัพท์
  phone                  String?        @db.VarChar(20)
  /// เบอร์มือถือ
  mobile                 String?        @db.VarChar(20)
  /// อีเมล
  email                  String?        @db.VarChar(100)
  /// เป็นผู้ติดต่อหลักหรือไม่
  is_primary             Boolean        @default(false)
  /// วันที่สร้างข้อมูล
  created_at             DateTime       @default(now())
  /// วันที่แก้ไขล่าสุด
  updated_at             DateTime       @updatedAt
  /// รหัสผู้ติดต่อ (PK)
  contact_id             Int            @id @default(autoincrement())
  /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  vendor_id              Int
  vendor                 vendor         @relation(fields: [vendor_id], references: [vendor_id])
  vendorMaster           vendor_master? @relation(fields: [vendor_masterVendor_id], references: [vendor_id])
  vendor_masterVendor_id Int?

  @@index([vendor_id])
}

/// ตารางเก็บข้อมูลบัญชีธนาคารของเจ้าหนี้
model vendor_bank_accounts {
  /// ชื่อธนาคาร
  bank_name              String         @db.VarChar(100)
  /// สาขาธนาคาร
  bank_branch            String         @db.VarChar(100)
  /// เลขที่บัญชีธนาคาร
  account_no             String         @db.VarChar(30)
  /// ชื่อบัญชี
  account_name           String         @db.VarChar(200)
  /// ประเภทบัญชี SAVING / CURRENT
  account_type           String         @db.VarChar(20)
  /// รหัส SWIFT (ถ้ามี)
  swift_code             String?        @db.VarChar(20)
  /// เป็นบัญชีหลักของเจ้าหนี้หรือไม่
  is_default             Boolean        @default(false)
  /// PK รหัสบัญชีธนาคาร
  bank_account_id        Int            @id @default(autoincrement())
  /// FK รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  vendor_id              Int
  vendor                 vendor         @relation(fields: [vendor_id], references: [vendor_id])
  vendorMaster           vendor_master? @relation(fields: [vendor_masterVendor_id], references: [vendor_id])
  vendor_masterVendor_id Int?

  @@index([vendor_id])
  @@map("vendor_bank_accounts")
}

/// ตารางเอกสารประกอบของเจ้าหนี้
model vendor_documents {
  /// ประเภทเอกสาร
  document_type String?       @db.VarChar(50)
  /// เลขที่เอกสาร
  document_no   String?       @db.VarChar(50)
  /// วันที่ออกเอกสาร
  issue_date    DateTime?     @db.Date
  /// วันหมดอายุ
  expiry_date   DateTime?     @db.Date
  /// ที่อยู่ไฟล์
  file_path     String?       @db.VarChar(500)
  /// ชื่อไฟล์
  file_name     String?       @db.VarChar(200)
  /// หมายเหตุ
  remark        String?
  /// วันที่สร้างข้อมูล
  created_at    DateTime      @default(now())
  /// วันที่แก้ไขล่าสุด
  updated_at    DateTime      @updatedAt
  /// รหัสเอกสาร (PK)
  document_id   Int           @id @default(autoincrement())
  /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  vendor_id     Int
  vendor        vendor_master @relation(fields: [vendor_id], references: [vendor_id])

  @@index([vendor_id])
  @@map("vendor_documents")
}

/// ตารางบันทึกผลการประเมินเจ้าหนี้
model vendor_performance {
  /// รหัสการประเมิน (PK)
  performance_id    Int           @id @default(autoincrement())
  /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  vendor_id         Int
  /// วันที่ประเมิน
  evaluation_date   DateTime?     @db.Date
  /// งวดการประเมิน
  evaluation_period String?       @db.VarChar(20)
  /// คะแนนคุณภาพ
  quality_score     Decimal?      @db.Decimal(5, 2)
  /// คะแนนการส่งมอบ
  delivery_score    Decimal?      @db.Decimal(5, 2)
  /// คะแนนราคา
  price_score       Decimal?      @db.Decimal(5, 2)
  /// คะแนนบริการ
  service_score     Decimal?      @db.Decimal(5, 2)
  /// คะแนนรวม
  total_score       Decimal?      @db.Decimal(5, 2)
  /// เกรดประเมิน
  rating            String?       @db.VarChar(1)
  /// หมายเหตุ
  remark            String?
  /// ผู้ประเมิน
  evaluated_by      String?       @db.VarChar(50)
  /// วันที่สร้างข้อมูล
  created_at        DateTime      @default(now())
  /// วันที่แก้ไขล่าสุด
  updated_at        DateTime      @updatedAt
  vendor            vendor_master @relation(fields: [vendor_id], references: [vendor_id])

  @@map("vendor_performance")
}

/// ตารางหมวดหมู่เจ้าหนี้
model vendor_categories {
  /// รหัสหมวดหมู่ (PK)
  category_id        Int      @id @default(autoincrement())
  /// รหัสหมวดหมู่
  category_code      String?  @db.VarChar(20)
  /// ชื่อหมวดหมู่
  category_name      String?  @db.VarChar(100)
  /// รหัสหมวดหมู่แม่
  parent_category_id String?  @db.VarChar(20)
  /// สถานะการใช้งาน
  is_active          Boolean?

  @@map("vendor_categories")
}

/// ตารางเงื่อนไขการชำระ
model payment_terms {
  /// รหัสเงื่อนไขการชำระ (PK)
  payment_term_id Int      @id @default(autoincrement())
  /// รหัสเงื่อนไข
  term_code       String?  @db.VarChar(20)
  /// ชื่อเงื่อนไข
  term_name       String?  @db.VarChar(100)
  /// จำนวนวัน
  days            Int?
  /// สถานะการใช้งาน
  is_active       Boolean?

  @@map("payment_terms")
}

//////////////
/// Transaction Procurement Tables
/////////////

///ตารางเก็บข้อมูลหลักของใบขอซื้อ (Purchase Requisition Header) (P1)
model pr_header {
  ///รหัสใบขอซื้อ (PK)
  pr_id             Int       @id @default(autoincrement())
  ///เลขที่ใบขอซื้อ
  pr_no             String    @db.VarChar(30)
  ///วันที่สร้างใบขอซื้อ
  pr_date           DateTime
  ///รหัสสาขา (FK)
  branch_id         Int
  ///รหัสคลัง (FK)
  warehouse_id      Int?
  ///วันที่ต้องการ
  need_by_date      DateTime?
  ///สถานะ
  status            String    @db.VarChar(20)
  ///รหัสสกุลเงิน
  currency_code     String    @db.VarChar(3)
  ///อัตราแลกเปลี่ยน
  exchange_rate     Decimal   @db.Decimal(18, 2)
  ///หมายเหตุ
  remark            String?   @db.Text
  ///จำนวนเงินรวม ยอดประมาณการ
  total_est_amount  Decimal   @db.Decimal(18, 2)
  ///เครดิตเทอม (วัน)
  payment_term_days Int?
  ///วันที่สร้าง
  created_at        DateTime  @default(now())
  ///วันที่แก้ไขล่าสุด
  updated_at        DateTime  @updatedAt

  branch              org_branch             @relation(fields: [branch_id], references: [branch_id])
  warehouse           warehouse?             @relation(fields: [warehouse_id], references: [warehouse_id])
  prLines             pr_line[]
  quoteCompareHeaders quote_compare_header[]
  rfqHeaders          rfq_header[]
}

/// ตารางเก็บข้อมูลรายละเอียดของใบขอซื้อ (Purchase Requisition Line) (P2)
model pr_line {
  ///รหัสใบขอซื้อ (PK)
  pr_line_id                    Int            @id @default(autoincrement())
  ///ลำดับ
  line_no                       Int
  ///รหัสสินค้า (FK)
  item_id                       Int?
  ///รายละเอียด
  description                   String?        @db.Text
  ///รหัสใบขอซื้อ (FK)
  pr_id                         Int
  ///จำนวน
  qty                           Decimal        @db.Decimal(18, 3)
  ///รหัสหน่วยนับ (FK)
  uom_id                        Int
  ///ราคาต่อหน่วยโดยประมาณ
  est_unit_price                Decimal        @db.Decimal(18, 4)
  ///รหัสภาษี
  tax_code                      String?        @db.VarChar(20)
  ///รหัสศูนย์ต้นทุน (FK)
  cost_center_id                Int
  ///รหัสโครงการ (FK)
  project_id                    Int
  ///ประเภทการรับสินค้าที่ต้องการ
  required_receipt_type         String?        @db.VarChar(20)
  ///รหัสผู้ขายที่ต้องการ (FK)
  preferred_vendor_id           Int?
  // ======================
  // Relations
  // ======================
  ///ใบขอซื้อ
  pr                            pr_header      @relation(fields: [pr_id], references: [pr_id])
  ///สินค้า
  item                          item_type?     @relation(fields: [item_id], references: [item_type_id])
  ///หน่วยนับ
  uom                           uom            @relation(fields: [uom_id], references: [uom_id])
  ///ศูนย์ต้นทุน
  cost_center                   cost_center    @relation(fields: [cost_center_id], references: [cost_center_id])
  ///โครงการ
  project                       project        @relation(fields: [project_id], references: [project_id])
  ///ผู้ขายที่ต้องการ
  preferred_vendor              vendor?        @relation(fields: [preferred_vendor_id], references: [vendor_id])
  ///หมวดหมู่สินค้า
  itemCategory                  item_category? @relation(fields: [item_categoryItem_category_id], references: [item_category_id])
  ///รหัสหมวดหมู่สินค้า
  item_categoryItem_category_id Int?

  @@unique([pr_id, line_no])
  @@index([pr_id])
}

/// ตารางเก็บข้อมูลหลักของใบขอซื้อ (Purchase for Quotation Header) (P3)
model rfq_header {
  ///รหัสใบขอซื้อ (PK)
  rfq_id             Int       @id @default(autoincrement())
  ///เลขที่ใบขอซื้อ
  rfq_no             String    @db.VarChar(30)
  ///วันที่สร้างใบขอซื้อ
  rfq_date           DateTime
  ///รหัสใบขอซื้อ (FK)
  qc_id              Int
  ///รหัสใบขอซื้อ (FK)
  pr_id              Int
  ///รหัสสาขา (FK)
  branch_id          Int
  ///ผู้ขอ
  requested_by       String    @db.VarChar(50)
  ///สถานะ
  status             String    @db.VarChar(20)
  ///วันที่ต้องการ
  quotation_due_date DateTime?
  ///รหัสสกุลเงิน
  currency_code      String    @db.VarChar(3)
  ///อัตราแลกเปลี่ยน
  exchange_rate      Decimal   @db.Decimal(18, 2)
  ///สถานที่รับสินค้า
  receive_location   String?   @db.Text
  ///เงื่อนไขการชำระเงิน
  payment_term_hint  String?   @db.VarChar(20)
  ///เงื่อนไขการส่งมอบ
  incoterm           String?   @db.VarChar(20)
  ///หมายเหตุ
  remarks            String?   @db.Text
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt

  qc       quote_compare_header @relation(fields: [qc_id], references: [qc_id])
  pr       pr_header            @relation(fields: [pr_id], references: [pr_id])
  branch   org_branch           @relation(fields: [branch_id], references: [branch_id])
  rfqLines rfq_line[]
}

/// ตารางเก็บข้อมูลหลักของใบขอซื้อ (Purchase for Quotation Line) (P4)
model rfq_line {
  ///รหัสใบขอซื้อ (PK)
  rfq_line_id                   Int            @id @default(autoincrement())
  ///ลำดับ
  line_no                       Int
  ///รหัสสินค้า (FK)
  item_id                       Int?
  ///รายละเอียด
  description                   String?        @db.Text
  ///รหัสใบขอซื้อ (FK)
  rfq_id                        Int
  ///จำนวน
  qty                           Decimal        @db.Decimal(18, 3)
  ///รหัสหน่วยนับ (FK)
  uom_id                        Int
  ///ราคาต่อหน่วยโดยประมาณ
  // est_unit_price                Decimal        @db.Decimal(18, 4)
  ///รหัสภาษี
  tax_code                      String?        @db.VarChar(20)
  ///รหัสศูนย์ต้นทุน (FK)
  cost_center_id                Int
  ///รหัสโครงการ (FK)
  project_id                    Int
  ///ประเภทการรับสินค้าที่ต้องการ
  required_receipt_type         String?        @db.VarChar(20)
  ///รหัสผู้ขายที่ต้องการ (FK)
  preferred_vendor_id           Int?
  // ======================
  // Relations
  // ======================
  ///ใบขอซื้อ
  rfq                           rfq_header     @relation(fields: [rfq_id], references: [rfq_id])
  ///สินค้า
  item                          item_type?     @relation(fields: [item_id], references: [item_type_id])
  ///หน่วยนับ
  uom                           uom            @relation(fields: [uom_id], references: [uom_id])
  ///ศูนย์ต้นทุน
  cost_center                   cost_center    @relation(fields: [cost_center_id], references: [cost_center_id])
  ///โครงการ
  project                       project        @relation(fields: [project_id], references: [project_id])
  ///ผู้ขายที่ต้องการ
  preferred_vendor              vendor?        @relation(fields: [preferred_vendor_id], references: [vendor_id])
  ///หมวดหมู่สินค้า
  itemCategory                  item_category? @relation(fields: [item_categoryItem_category_id], references: [item_category_id])
  ///รหัสหมวดหมู่สินค้า
  item_categoryItem_category_id Int?

  @@unique([rfq_id, line_no])
  @@index([rfq_id])
}

/// ตารางเก็บข้อมูลหลักของใบเปรียบเทียบราคา (Purchase Requisition Header) (P5)
model quote_compare_header {
  ///รหัสใบเปรียบเทียบราคา (PK)
  qc_id      Int      @id @default(autoincrement())
  ///เลขที่ใบเปรียบเทียบราคา
  qc_no      String   @unique @db.VarChar(30)
  ///รหัสใบขอซื้อ (FK)
  pr_id      Int
  ///สถานะ
  status     String   @db.VarChar(20)
  ///วันที่สร้าง
  created_at DateTime @default(now())
  ///วันที่แก้ไขล่าสุด
  updated_at DateTime @updatedAt

  /// ใบขอซื้อ (FK)
  pr         pr_header    @relation(fields: [pr_id], references: [pr_id])
  rfqHeaders rfq_header[]
}
