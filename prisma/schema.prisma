generator client {
  provider = "prisma-client-js"
  // previewFeatures = ["prismaSchemaFolder"]
}

datasource db {
  provider = "postgresql" // หรือ mysql
  url      = env("DATABASE_URL")
}

//////////////////////
// MASTER
//////////////////////

model OrgBranch {
  branch_id   String  @id @default(uuid())
  branch_code String  @db.VarChar(20)
  branch_name String  @db.VarChar(200)
  is_active   Boolean @default(true)

  warehouses Warehouse[]

  @@map("org_branch")
}

model Warehouse {
  warehouse_id   String @id @default(uuid())
  branch_id      String
  warehouse_code String @db.VarChar(20)
  warehouse_name String @db.VarChar(200)

  branch OrgBranch @relation(fields: [branch_id], references: [branch_id])

  @@map("warehouse")
}

model Vendor {
  vendor_id         String  @id @default(uuid())
  vendor_code       String  @db.VarChar(30)
  vendor_name       String  @db.VarChar(255)
  tax_id            String? @db.VarChar(20)
  payment_term_days Int
  status            String  @db.VarChar(20)

  @@map("vendor")
}

model Item {
  item_id   String @id @default(uuid())
  item_code String @db.VarChar(50)
  item_name String @db.VarChar(255)
  item_type String @db.VarChar(20)
  uom       String @db.VarChar(20)

  @@map("item")
}

model CostCenter {
  cost_center_id   String @id @default(uuid())
  cost_center_code String @db.VarChar(30)
  cost_center_name String @db.VarChar(200)

  @@map("cost_center")
}

model Project {
  project_id   String @id @default(uuid())
  project_code String @db.VarChar(30)
  project_name String @db.VarChar(200)

  @@map("project")
}

//////////////////////
// Vender Master Data
//////////////////////

/// ตารางเจ้าหนี้
model vendor_master {
  vendor_id             Int       @id @default(autoincrement()) /// PK รหัสอ้างอิงเจ้าหนี้
  vendor_code           String?   @db.VarChar(20) /// รหัสเจ้าหนี้
  vendor_name           String?   @db.VarChar(200) /// ชื่อเจ้าหนี้ (ไทย)
  vendor_name_en        String?   @db.VarChar(200) /// ชื่อเจ้าหนี้ (อังกฤษ)
  vendor_type           String?   @db.VarChar(30) /// ประเภทเจ้าหนี้ (MANUFACTURER, DISTRIBUTOR, etc.)
  category              String?   @db.VarChar(100) /// หมวดหมู่ธุรกิจ
  tax_id                String?   @db.VarChar(13) /// เลขประจำตัวผู้เสียภาษี
  branch_name           String?   @db.VarChar(100) /// ชื่อสาขา
  is_vat_registered     Boolean? /// จดทะเบียน VAT หรือไม่
  wht_applicable        Boolean? /// มีการหัก ณ ที่จ่ายหรือไม่
  payment_term_days     Int? /// เงื่อนไขการชำระเงิน (วัน)
  credit_limit          Decimal?  @db.Decimal(15, 2) /// วงเงินเครดิต
  currency_code         String?   @db.VarChar(3) /// รหัสสกุลเงิน
  status                String?   @db.VarChar(20) /// สถานะ (ACTIVE, INACTIVE)
  rating                String?   @db.VarChar(1) /// เกรดประเมิน (A–E)
  performance_score     Decimal?  @db.Decimal(5, 2) /// คะแนนประเมินผล (0–100)
  contact_person        String?   @db.VarChar(100) /// ผู้ติดต่อหลัก
  phone                 String?   @db.VarChar(20) /// เบอร์โทรศัพท์
  mobile                String?   @db.VarChar(20) /// เบอร์มือถือ
  email                 String?   @db.VarChar(100) /// อีเมล
  website               String?   @db.VarChar(200) /// เว็บไซต์
  address               String?   @db.Text /// ที่อยู่
  district              String?   @db.VarChar(100) /// เขต/อำเภอ
  province              String?   @db.VarChar(100) /// จังหวัด
  postal_code           String?   @db.VarChar(10) /// รหัสไปรษณีย์
  country               String?   @db.VarChar(100) /// ประเทศ
  registration_date     DateTime? @db.Date /// วันที่ลงทะเบียน
  approved_date         DateTime? @db.Date /// วันที่อนุมัติ
  last_transaction_date DateTime? @db.Date /// วันที่ทำธุรกรรมล่าสุด
  total_purchase_amount Decimal?  @db.Decimal(15, 2) /// มูลค่าการซื้อทั้งหมด
  remark                String?   @db.Text /// หมายเหตุ
  created_by            String?   @db.VarChar(50) /// ผู้สร้าง
  created_date          DateTime  @default(now()) /// วันที่สร้าง
  updated_by            String?   @db.VarChar(50) /// ผู้แก้ไข
  updated_date          DateTime  @updatedAt /// วันที่แก้ไข

  vendorContacts     vendor_contacts[]
  vendorBankAccounts vendor_bank_accounts[]
  vendorDocuments    vendor_documents[]
  vendorPerformances vendor_performance[]

  @@map("vendor_master")
}

/// ตารางผู้ติดต่อ
model vendor_contacts {
  contact_id   Int      @id @default(autoincrement()) /// รหัสผู้ติดต่อ (PK)
  vendor_id    Int /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  contact_name String   @db.VarChar(100) /// ชื่อผู้ติดต่อ
  position     String?  @db.VarChar(100) /// ตำแหน่ง
  department   String?  @db.VarChar(100) /// แผนก
  phone        String?  @db.VarChar(20) /// เบอร์โทรศัพท์
  mobile       String?  @db.VarChar(20) /// เบอร์มือถือ
  email        String?  @db.VarChar(100) /// อีเมล
  is_primary   Boolean  @default(false) /// เป็นผู้ติดต่อหลักหรือไม่
  created_at   DateTime @default(now()) /// วันที่สร้างข้อมูล
  updated_at   DateTime @updatedAt /// วันที่แก้ไขล่าสุด

  vendor vendor_master @relation(fields: [vendor_id], references: [vendor_id]) /// ความสัมพันธ์กับตาราง vendor_master

  @@index([vendor_id]) /// ช่วยให้ join / query เร็วขึ้น
}

/// ตารางเก็บข้อมูลบัญชีธนาคารของเจ้าหนี้
model vendor_bank_accounts {
  bank_account_id Int     @id @default(autoincrement()) /// PK รหัสบัญชีธนาคาร
  vendor_id       Int /// FK รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  bank_name       String  @db.VarChar(100) /// ชื่อธนาคาร
  bank_branch     String  @db.VarChar(100) /// สาขาธนาคาร
  account_no      String  @db.VarChar(30) /// เลขที่บัญชีธนาคาร
  account_name    String  @db.VarChar(200) /// ชื่อบัญชี
  account_type    String  @db.VarChar(20) /// ประเภทบัญชี SAVING / CURRENT
  swift_code      String? @db.VarChar(20) /// รหัส SWIFT (ถ้ามี)
  is_default      Boolean @default(false) /// เป็นบัญชีหลักของเจ้าหนี้หรือไม่

  vendor vendor_master @relation(fields: [vendor_id], references: [vendor_id]) /// relation ไป vendor_master

  @@index([vendor_id]) /// ช่วยให้ join / query เร็วขึ้น
  @@map("vendor_bank_accounts") /// map ชื่อตารางจริงใน database
}

/// ตารางเอกสารประกอบของเจ้าหนี้
model vendor_documents {
  document_id   Int       @id @default(autoincrement()) /// รหัสเอกสาร (PK)
  vendor_id     Int /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  document_type String?   @db.VarChar(50) /// ประเภทเอกสาร
  document_no   String?   @db.VarChar(50) /// เลขที่เอกสาร
  issue_date    DateTime? @db.Date /// วันที่ออกเอกสาร
  expiry_date   DateTime? @db.Date /// วันหมดอายุ
  file_path     String?   @db.VarChar(500) /// ที่อยู่ไฟล์
  file_name     String?   @db.VarChar(200) /// ชื่อไฟล์
  remark        String?   @db.Text /// หมายเหตุ
  created_at    DateTime  @default(now()) /// วันที่สร้างข้อมูล
  updated_at    DateTime  @updatedAt /// วันที่แก้ไขล่าสุด

  vendor vendor_master @relation(fields: [vendor_id], references: [vendor_id]) /// ความสัมพันธ์เจ้าหนี้

  @@index([vendor_id]) /// ช่วยให้ join / query เร็วขึ้น
  @@map("vendor_documents") /// map ชื่อตารางจริงใน database
}

/// ตารางบันทึกผลการประเมินเจ้าหนี้
model vendor_performance {
  performance_id    Int       @id @default(autoincrement()) /// รหัสการประเมิน (PK)
  vendor_id         Int /// รหัสอ้างอิงเจ้าหนี้ (FK → vendor_master.vendor_id)
  evaluation_date   DateTime? @db.Date /// วันที่ประเมิน
  evaluation_period String?   @db.VarChar(20) /// งวดการประเมิน
  quality_score     Decimal?  @db.Decimal(5, 2) /// คะแนนคุณภาพ
  delivery_score    Decimal?  @db.Decimal(5, 2) /// คะแนนการส่งมอบ
  price_score       Decimal?  @db.Decimal(5, 2) /// คะแนนราคา
  service_score     Decimal?  @db.Decimal(5, 2) /// คะแนนบริการ
  total_score       Decimal?  @db.Decimal(5, 2) /// คะแนนรวม
  rating            String?   @db.VarChar(1) /// เกรดประเมิน
  remark            String?   @db.Text /// หมายเหตุ
  evaluated_by      String?   @db.VarChar(50) /// ผู้ประเมิน
  created_at        DateTime  @default(now()) /// วันที่สร้างข้อมูล
  updated_at        DateTime  @updatedAt /// วันที่แก้ไขล่าสุด

  vendor vendor_master @relation(fields: [vendor_id], references: [vendor_id]) /// ความสัมพันธ์เจ้าหนี้

  @@map("vendor_performance")
}

/// ตารางหมวดหมู่เจ้าหนี้
model vendor_categories {
  category_id        Int      @id @default(autoincrement()) /// รหัสหมวดหมู่ (PK)
  category_code      String?  @db.VarChar(20) /// รหัสหมวดหมู่
  category_name      String?  @db.VarChar(100) /// ชื่อหมวดหมู่
  parent_category_id String?  @db.VarChar(20) /// รหัสหมวดหมู่แม่
  is_active          Boolean? /// สถานะการใช้งาน

  // parent vendor_categories? @relation("CategoryHierarchy", fields: [parent_category_id], references: [category_id]) /// หมวดหมู่แม่
  // children vendor_categories[] @relation("CategoryHierarchy") /// หมวดหมู่ลูก

  @@map("vendor_categories")
}

model payment_terms {
  payment_term_id Int      @id @default(autoincrement()) /// รหัสเงื่อนไขการชำระ (PK)
  term_code       String?  @db.VarChar(20) /// รหัสเงื่อนไข
  term_name       String?  @db.VarChar(100) /// ชื่อเงื่อนไข
  days            Int? /// จำนวนวัน
  is_active       Boolean? /// สถานะการใช้งาน

  @@map("payment_terms")
}

//////////////////////
// 
//////////////////////
